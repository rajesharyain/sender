# QR Mailer — How to Test

## Prerequisites

- **Android Studio** (recommended), or JDK 17 + Android SDK + Gradle
- For **instrumented tests**: device or emulator (or use Android Studio’s device manager)

---

## Quick start: Run the app in Android Studio

1. **Open the project**
   - In Android Studio: **File → Open**.
   - Select the folder: `R:\SimpleMailService` (the folder that contains `app`, `gradle`, `build.gradle.kts`).
   - Click **OK**. Wait for the project to open and for the bottom status to show “Gradle sync finished” (or **File → Sync Project with Gradle Files** if needed).

2. **Set up a device**
   - **Emulator:** **Tools → Device Manager → Create Device** (e.g. Pixel 6, API 34) → **Finish**. Then click the green **Play** next to the AVD to start it.
   - **Physical phone:** Enable **Developer options** and **USB debugging**, connect via USB, allow debugging when prompted. The device should appear in the device dropdown.
   - **If install fails with "INSTALL_FAILED_USER_RESTRICTED"** on Realme/Oppo/Xiaomi/Vivo etc., enable **Install via USB** (or **USB debugging (Security settings)** / **Disable permission monitoring**) in **Settings → Developer options**, then try installing again. See **Troubleshooting** below.

3. **Run the app**
   - In the toolbar, open the **device dropdown** (next to the green Run button) and select your emulator or phone.
   - Click the green **Run** button (or **Run → Run 'app'**).
   - The app installs and launches. You should see the **QR Mailer** home screen with “Generate My QR” and “Scan QR & Send Documents”.

4. **Manual test flow (Phases 1–3)**
   - **Home:** Tap **Generate My QR** → you should see “Generate My QR” and an email field. Tap **←** to go back. Tap **Scan QR & Send Documents** → you should see “Scan QR Code” (and camera permission if first time). Tap **←** to go back.
   - **Generate QR:** Tap **Generate My QR** → enter an email (e.g. `test@example.com`) → **Generate QR Code** → QR and “Download QR” / “Share QR” appear. Tap **←** to go back.
   - **Scan & confirm:** Tap **Scan QR & Send Documents** → grant **Camera** if asked → point the camera at a QR generated by the app (e.g. from another device or from the same app’s “Generate My QR” screen shown on another phone). When the QR is recognised you should see “You are sending documents to: [email]”. Tap **Continue** → “Select Documents (Phase 4)” placeholder. Tap **Back** to return.

---

## Troubleshooting: INSTALL_FAILED_USER_RESTRICTED

If `.\gradlew.bat installDebug` or Android Studio Run fails with:

```text
INSTALL_FAILED_USER_RESTRICTED: Install canceled by user
```

the **phone** is blocking app installs over USB. Fix it on the device:

1. Open **Settings → Developer options** (enable Developer options first if needed: **Settings → About phone** → tap **Build number** 7 times).
2. Find and **turn ON** one of these (name varies by brand):
   - **Install via USB** (Realme, Oppo, some others)
   - **USB debugging (Security settings)** or **Allow install via USB**
   - **Disable permission monitoring** (Xiaomi: turn this ON to allow installs)
3. If asked, sign in with your **Mi Account** (Xiaomi) or confirm the option.
4. Keep USB connected and run **.\gradlew.bat installDebug** again, or use **Run** in Android Studio.

**Alternative:** Install the APK manually: copy `app\build\outputs\apk\debug\app-debug.apk` to the phone (e.g. via USB file transfer or cloud) and open it on the phone to install.

---

## 1. Unit tests (JVM, no device)

Run all unit tests from the project root:

```bash
# Windows (PowerShell or cmd)
.\gradlew.bat testDebugUnitTest

# Or if you use Gradle directly
gradle testDebugUnitTest
```

**In Android Studio:** Right‑click `app/src/test` → **Run 'Tests in com.qrmailer'**, or open a test file and click the run icon next to the class/method.

**What runs:** `RoutesTest` (route constants and uniqueness).

---

## 2. Instrumented / UI tests (device or emulator)

These tests run on a connected device or running emulator.

1. Start an **Android emulator** (AVD) or connect a device with USB debugging.
2. From the project root:

```bash
# Run all instrumented tests
.\gradlew.bat connectedDebugAndroidTest
```

**In Android Studio:** Right‑click `app/src/androidTest` → **Run 'Tests in androidTest'**, or run a single test class (e.g. `HomeScreenTest`, `NavigationTest`).

**What runs:**
- **HomeScreenTest** – title and both buttons visible; button click callbacks.
- **NavigationTest** – start destination is Home; “Generate My QR” → QR Owner screen; “Scan QR” → Scan screen; Back from QR Owner → Home.

---

## 3. Build and run the app (manual testing)

### Option A: Android Studio

1. **Open project:** File → Open → select the `SimpleMailService` folder.
2. **Sync:** File → Sync Project with Gradle Files (or use the elephant icon).
3. **Run:** Select a device/emulator in the toolbar and click **Run** (green triangle), or **Run → Run 'app'**.

### Option B: Command line

From the project root:

```bash
# Build debug APK
.\gradlew.bat assembleDebug

# Install and run on connected device/emulator (after app is installed, launch it from the launcher)
.\gradlew.bat installDebug
```

APK output: `app/build/outputs/apk/debug/app-debug.apk`.

### Manual checks (Phase 1)

1. **Launch** – App opens to the Home screen with “QR Mailer” and two buttons.
2. **Generate My QR** – Tap → “QR Owner (Phase 2)” screen; tap **Back** → returns to Home.
3. **Scan QR & Send Documents** – Tap → “Scan QR (Phase 3)” screen; tap **Back** → returns to Home.

---

## 4. Test summary

| Test type        | Location              | Command / How to run                    |
|------------------|------------------------|-----------------------------------------|
| Unit             | `app/src/test/`       | `.\gradlew.bat testDebugUnitTest`        |
| Instrumented/UI  | `app/src/androidTest/`| `.\gradlew.bat connectedDebugAndroidTest`|
| Build            | —                     | `.\gradlew.bat assembleDebug`           |
| Install & run    | —                     | `.\gradlew.bat installDebug` + launch   |

If the Gradle wrapper is missing, open the project in Android Studio and use **File → Sync Project with Gradle Files** so it can create the wrapper, then use the commands above.
